server {
    listen 80;
    server_name localhost;

    # Optimized Video Serving
    location /videos/ {
        alias /data/;
        autoindex off;
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;

        # Enable Range requests (Standard in Nginx, but good to be explicit about support)
        add_header Accept-Ranges bytes;

        # CORS if needed (though reverse proxying avoids this)
        add_header Access-Control-Allow-Origin *;
    }

    # API Proxy
    location /api/ {
        proxy_pass http://app:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade"; # Important for SSE
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_buffering off; # Important for SSE/Streaming
    }

    # Frontend Proxy (Vite Dev Server)
    location / {
        proxy_pass http://frontend:5173;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
